<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>jQuery UI Autocomplete - Categories</title>
		<link rel="stylesheet" href="../../themes/base/jquery.ui.all.css">
		<script src="../../jquery-1.8.0.js"></script>
		<script src="../../ui/jquery.ui.core.js"></script>
		<script src="../../ui/jquery.ui.widget.js"></script>
		<script src="../../ui/jquery.ui.position.js"></script>
		<script src="../../ui/jquery.ui.autocomplete.js"></script>
		<link rel="stylesheet" href="../demos.css">
		<style>
			/* *** Scrollable autocomplete *** */
			.ui-autocomplete {
				max-height: 100px;
				overflow-y: auto;
				/* prevent horizontal scrollbar */
				overflow-x: hidden;
				/* add padding to account for vertical scrollbar */
				padding-right: 20px;
			}
			/* IE 6 doesn't support max-height
			* we use height instead, but this forces the menu to always be this tall
			*/
			* html .ui-autocomplete {
				height: 100px;
			}

			/* *** Categories autocomplete *** */
			.ui-autocomplete-category {
				font-weight: bold;
				padding: .2em .4em;
				margin: .8em 0 .2em;
				line-height: 1.5;
			}
		</style>
		<script>
			/* 
			I think that The code below creates a class extending ithe autocomplete class.
			Thus, instead of invoking the autocomplete class, you must invoke mil_complete.
			*/
			$.widget( "custom.mil_complete", $.ui.autocomplete, {
				_renderMenu: function( ul, items ) {
					var self = this,
					currentCategory = "";
					$.each( items, function( index, item ) {
						if ( item.category != currentCategory ) {
							ul.append( "<li class='ui-autocomplete-category'>" + item.category + "</li>" );
							currentCategory = item.category;
						}
						self._renderItem( ul, item );
					});i
				}
			});
		</script>
		<script>
			/*
			VERY IMPORTANT: 
			- it seems that the filtering (sending the $_GET['term'] via ajax) filters on labels.
			- Then, by default, if there is a "value" this value populates the input.
			*/
			$(function() {
				var data = [
				{category: "Actors", label: "Redford", db_store: "1"},
				{category: "Actors", label: "Pitt", db_store: "2"},
				{category: "Actors", label: "Wayne", db_store: "3"},
				{category: "Actors", label: "Dujardin", db_store: "4"},
				{category: "Actors", label: "Selec", db_store: "5"},
				{category: "Actors", label: "Costner", db_store: "6"},
				{category: "Actress", label: "Johanson", db_store: "6"},
				{category: "Actress", label: "Monroe", db_store: "8"},
				{category: "Actress", label: "Dunst", db_store: "9"},
				{category: "Singer", label: "Jaeger", db_store: "10"},
				{category: "Singer", label: "Mae", db_store: "11"},
				{category: "Singer", label: "Willem", db_store: "12"}
				];

				$( "#search" ).autocomplete({
					//delay: 0,
					//source: data,
					//source: "search.php",
					source: "mil_server.ajax.php"
					//minLength: 0,	// number of char to input before starting autocomplete
					, select: function ( event, ui ) {
						//console.log($.type(ui.item));
						//console.log(ui);
						$('#search').val(ui.item.label);
						$('#db_store').val(ui.item.db_store);
					}
					, change: function( event, ui ) {
						if ($('#search').val() !== "")
						{
							if ($('#db_store').val() === "")
							{
								$('#search').focus();
							}
						}
					}
					, close: function( event, ui ) {console.log ("close");}
					, create: function( event, ui ) {console.log ("create");}
					, focus: function( event, ui ) {console.log ("focus");}
					, open: function( event, ui ) {console.log ("open");}
					//, response: function( event, ui ) {console.log ("response");} // added to the jquery-ui version 1.9.2 but still bugs...
					, search: function( event, ui ) {console.log ("search");}
				});
			});
		</script>
	</head>
	<body>

		<div class="demo">
			<label for="search">Search: </label>
			<input id="search" />
			<input id="db_store" />
		</div><!-- End demo -->



		<div class="demo-description">
			<p>A categorized search result. Try typing "a" or "n".</p>
		</div><!-- End demo-description -->

	</body>
</html>
